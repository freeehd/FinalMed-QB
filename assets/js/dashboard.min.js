const jQuery=window.jQuery;jQuery(document).ready(c=>{const n=c("#wqb-dashboard-root"),d=window.wqb_data;if(n.length===0)return;function p(t){const s=t.performance_stats,a=t.heatmap_data;let e=`
            <div class="wqb-dashboard">
                <div class="wqb-breadcrumb-navigation">
                    <div class="wqb-breadcrumb-container">
                        <button class="wqb-breadcrumb-btn wqb-button-secondary" onclick="window.location.href='/staging-area'">
                            <span class="wqb-button-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="9,22 9,12 15,12 15,22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            Back to Home
                        </button>
                        <div class="wqb-breadcrumb-separator">\u203A</div>
                        <span class="wqb-breadcrumb-current">Performance Dashboard</span>
                    </div>
                </div>
                
                <div class="wqb-dashboard-header">
                    <h1>Your Performance Dashboard</h1>
                    <p>Track your progress and identify areas for improvement</p>
                </div>

                <div class="wqb-stats-section">
                    <h2>Lifetime Statistics</h2>
                    <div class="wqb-stats-grid">
                        <div class="wqb-stat-card wqb-stat-primary">
                            <div class="wqb-stat-icon">\u{1F4CA}</div>
                            <div class="wqb-stat-content">
                                <div class="wqb-stat-value">${s.overall_percentage}%</div>
                                <div class="wqb-stat-label">Overall Accuracy</div>
                            </div>
                        </div>
                        <div class="wqb-stat-card wqb-stat-success">
                            <div class="wqb-stat-icon">\u2705</div>
                            <div class="wqb-stat-content">
                                <div class="wqb-stat-value">${s.overall_correct}</div>
                                <div class="wqb-stat-label">Correct Answers</div>
                            </div>
                        </div>
                        <div class="wqb-stat-card wqb-stat-info">
                            <div class="wqb-stat-icon">\u{1F4DD}</div>
                            <div class="wqb-stat-content">
                                <div class="wqb-stat-value">${s.overall_total}</div>
                                <div class="wqb-stat-label">Total Answered</div>
                            </div>
                        </div>
                        <div class="wqb-stat-card wqb-stat-warning">
                            <div class="wqb-stat-icon">\u{1F4C8}</div>
                            <div class="wqb-stat-content">
                                <div class="wqb-stat-value">${s.overall_total-s.overall_correct}</div>
                                <div class="wqb-stat-label">Incorrect Answers</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="wqb-specialty-section">
                    <h2>Performance by Specialty</h2>
                    <div class="wqb-table-container">
                        <table class="wqb-results-table wqb-results-tree">
                            <thead>
                                <tr>
                                    <th>Specialty</th>
                                    <th>Correct</th>
                                    <th>Total</th>
                                    <th>Accuracy %</th>
                                    <th>Accuracy</th>
                                </tr>
                            </thead>
                            <tbody>
                              ${w(s.specialties)}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="wqb-activity-section">
                    <h2>Recent Activity</h2>
                    <p class="wqb-section-description">Your question-answering activity over the last 30 days</p>
                    <div class="wqb-heatmap-container">
                        <div id="wqb-cal-heatmap"></div>
                        <div class="wqb-heatmap-legend">
                            <span class="wqb-legend-label">Less</span>
                            <div class="wqb-legend-scale">
                                <div class="wqb-legend-box" style="background-color: #ebedf0;"></div>
                                <div class="wqb-legend-box" style="background-color: #c6e48b;"></div>
                                <div class="wqb-legend-box" style="background-color: #7bc96f;"></div>
                                <div class="wqb-legend-box" style="background-color: #239a3b;"></div>
                                <div class="wqb-legend-box" style="background-color: #196127;"></div>
                            </div>
                            <span class="wqb-legend-label">More</span>
                        </div>
                    </div>
                </div>

                <div class="wqb-reset-section">
                    <div class="wqb-accordion">
                        <button class="wqb-accordion-toggle" type="button">
                            <span class="wqb-accordion-icon">\u26A0\uFE0F</span>
                            <span class="wqb-accordion-title">Resetting All User Progress</span>
                            <span class="wqb-accordion-arrow">\u25BC</span>
                        </button>
                        <div class="wqb-accordion-content" style="display: none;">
                            <div class="wqb-reset-warning">
                                <div class="wqb-warning-icon">\u{1F6A8}</div>
                                <div class="wqb-warning-content">
                                    <h4>Warning: This action cannot be undone!</h4>
                                    <p>Clicking the reset button will permanently delete all your question progress, including:</p>
                                    <ul>
                                        <li>All correct and incorrect answer records</li>
                                        <li>Your performance statistics</li>
                                        <li>Activity heatmap data</li>
                                        <li>Progress tracking for all questions</li>
                                    </ul>
                                    <p><strong>This action is irreversible and will reset your account to a completely fresh state.</strong></p>
                                </div>
                            </div>
                            <div class="wqb-reset-actions">
                                <button id="wqb-reset-progress-btn" class="wqb-button-danger" type="button">
                                    <span class="wqb-button-icon">\u{1F5D1}\uFE0F</span>
                                    Reset All Progress
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;n.html(e),q(a),u()}function q(t){window.WQBHeatmapUtils&&window.WQBHeatmapUtils.initializeDashboardHeatmap?window.WQBHeatmapUtils.initializeDashboardHeatmap(t).then(()=>{window.WQBHeatmapUtils&&window.WQBHeatmapUtils.reinitializeHeatmapOnResize&&window.WQBHeatmapUtils.reinitializeHeatmapOnResize("#wqb-cal-heatmap",t,{})}).catch(s=>{console.error("Failed to initialize dashboard heatmap:",s)}):console.error("WQBHeatmapUtils not available")}function w(t,s=0){if(!Array.isArray(t)||t.length===0)return"";let a="";return t.forEach(e=>{const l="&nbsp;".repeat(s*4),r=Array.isArray(e.children)&&e.children.length>0,i=e.total>0?Math.round(e.correct/e.total*100):0,h=i>=80?"high":i>=60?"medium":"low";a+=`
        <tr class="wqb-tree-row" data-level="${s}">
          <td>
            <div class="wqb-tree-cell">
              ${l}
              ${r?'<a href="#" class="wqb-tree-toggle" data-open="0">+</a>':'<span class="wqb-tree-toggle-placeholder"></span>'}
              <span class="wqb-tree-name">${e.name}</span>
            </div>
          </td>
          <td class="wqb-stat-correct">${e.correct}</td>
          <td class="wqb-stat-total">${e.total}</td>
          <td class="wqb-stat-percent">${i}%</td>
          <td class="wqb-progress-cell">
            <div class="wqb-progress-bar">
              <div class="wqb-progress-fill wqb-progress-${h}" style="width: ${i}%"></div>
            </div>
          </td>
        </tr>
      `,r&&e.children.forEach(o=>{const b=o.total>0?Math.round(o.correct/o.total*100):0,g=b>=80?"high":b>=60?"medium":"low",m="&nbsp;".repeat((s+1)*4),v=Array.isArray(o.children)&&o.children.length>0,y=v?'<a href="#" class="wqb-tree-toggle" data-open="0">+</a>':'<span class="wqb-tree-toggle-placeholder"></span>';a+=`
            <tr class="wqb-tree-row child-of-level-${s}" data-level="${s+1}" style="display:none;">
              <td>
                <div class="wqb-tree-cell">
                  ${m}
                  ${y}
                  <span class="wqb-tree-name">${o.name}</span>
                </div>
              </td>
              <td class="wqb-stat-correct">${o.correct}</td>
              <td class="wqb-stat-total">${o.total}</td>
              <td class="wqb-stat-percent">${b}%</td>
              <td class="wqb-progress-cell">
                <div class="wqb-progress-bar">
                  <div class="wqb-progress-fill wqb-progress-${g}" style="width: ${b}%"></div>
                </div>
              </td>
            </tr>
          `,v&&(a+=w([o],s+1))})}),a}function u(){n.on("click",".wqb-tree-toggle",function(t){t.preventDefault();const s=c(this),a=s.closest("tr"),e=parseInt(a.attr("data-level"),10),l=s.attr("data-open")==="1";let r=a.next();for(;r.length;){const i=parseInt(r.attr("data-level")||"-1",10);if(isNaN(i)||i<=e)break;i===e+1&&(l?r.hide():r.show()),r=r.next()}s.attr("data-open",l?"0":"1").text(l?"+":"\u2212")}),n.on("click",".wqb-accordion-toggle",function(){const t=c(this),s=t.next(".wqb-accordion-content"),a=t.find(".wqb-accordion-arrow");t.toggleClass("active"),s.slideToggle(200),t.hasClass("active")?a.text("\u25B2"):a.text("\u25BC")}),n.on("click","#wqb-reset-progress-btn",function(){const t=c(this),s=t.html();confirm(`\u26A0\uFE0F WARNING: This will permanently delete ALL your progress data!

This action cannot be undone. Are you absolutely sure you want to reset all your progress?`)&&confirm(`\u{1F6A8} FINAL WARNING: This will delete everything!

\u2022 All correct/incorrect answers
\u2022 All performance statistics
\u2022 All activity data
\u2022 All progress tracking

This is your last chance to cancel. Proceed with reset?`)&&(t.prop("disabled",!0),t.html('<span class="wqb-button-icon">\u23F3</span> Resetting...'),c.ajax({url:d.ajax_url,type:"POST",data:{action:"wqb_reset_user_progress",nonce:d.nonce},dataType:"json",success:a=>{var e;a.success?(t.html('<span class="wqb-button-icon">\u2705</span> Reset Complete!'),t.removeClass("wqb-button-danger").addClass("wqb-button-success"),setTimeout(()=>{location.reload()},2e3)):(t.html('<span class="wqb-button-icon">\u274C</span> Reset Failed'),t.removeClass("wqb-button-danger").addClass("wqb-button-error"),setTimeout(()=>{t.prop("disabled",!1),t.html(s),t.removeClass("wqb-button-error").addClass("wqb-button-danger")},3e3),alert("Failed to reset progress: "+(((e=a.data)==null?void 0:e.message)||"Unknown error")))},error:(a,e,l)=>{console.error("Reset progress error:",l),t.html('<span class="wqb-button-icon">\u274C</span> Reset Failed'),t.removeClass("wqb-button-danger").addClass("wqb-button-error"),setTimeout(()=>{t.prop("disabled",!1),t.html(s),t.removeClass("wqb-button-error").addClass("wqb-button-danger")},3e3),alert("Network error occurred while resetting progress. Please try again.")}}))})}n.html(`
        <div class="wqb-dashboard-loading">
            <div class="wqb-loading-spinner"></div>
            <p>Loading your dashboard...</p>
        </div>
    `),c.ajax({url:d.ajax_url,type:"POST",data:{action:"wqb_get_dashboard_data",nonce:d.nonce},dataType:"json",success:t=>{var s;t.success?p(t.data):n.html(`
                    <div class="wqb-dashboard-error">
                        <div class="wqb-error-icon">\u26A0\uFE0F</div>
                        <h3>Unable to Load Dashboard</h3>
                        <p>Could not load dashboard data. Please try refreshing the page.</p>
                        <p>Error: ${((s=t.data)==null?void 0:s.message)||"Unknown error"}</p>
                    </div>
                `)},error:(t,s,a)=>{console.error("AJAX Error:",{xhr:t,status:s,error:a}),n.html(`
                <div class="wqb-dashboard-error">
                    <div class="wqb-error-icon">\u{1F50C}</div>
                    <h3>Connection Error</h3>
                    <p>A network error occurred. Please check your connection and try again.</p>
                    <p>Details: ${a}</p>
                </div>
            `)}})});
